<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zeyuli.mappers.QueryBillMapper">

    <!-- 按日期区间 -->
    <select id="queryBillListOrderByDate" resultType="com.zeyuli.pojo.bo.GetBillListBo">
        SELECT id, record_enum, amount, date
        FROM bill_sys.user_bill
        WHERE user_id = #{userId}
        AND deleted = FALSE
        <if test="vo.startDate != null and vo.endDate != null">
            AND date BETWEEN #{vo.startDate} AND #{vo.endDate}
        </if>
        ORDER BY date DESC, id DESC
        LIMIT #{vo.limit} OFFSET #{vo.page}
    </select>

    <!-- 按账户 -->
    <select id="queryBillListOrderByAccount" resultType="com.zeyuli.pojo.bo.GetBillListBo">
        SELECT id, record_enum, amount, date
        FROM bill_sys.user_bill
        WHERE user_id = #{userId}
        AND deleted = FALSE
        AND account = #{vo.accountId}
        ORDER BY date DESC, id DESC
        LIMIT #{vo.limit} OFFSET #{vo.page}
    </select>

    <!-- 按金额区间 -->
    <select id="queryBillListOrderByAmountRange" resultType="com.zeyuli.pojo.bo.GetBillListBo">
        SELECT id, record_enum, amount, date
        FROM bill_sys.user_bill
        WHERE user_id = #{userId}
        AND deleted = FALSE
        <if test="vo.minAmount != null">
            AND amount >= #{vo.minAmount}
        </if>
        <if test="vo.maxAmount != null">
            AND amount &lt;= #{vo.maxAmount}
        </if>
        ORDER BY date DESC, id DESC
        LIMIT #{vo.limit} OFFSET #{vo.limit} * (#{vo.page} - 1)
    </select>

    <!-- 按收支类型 -->
    <select id="queryBillListOrderByUsageType" resultType="com.zeyuli.pojo.bo.GetBillListBo">
        SELECT id, record_enum, amount, date
        FROM bill_sys.user_bill
        WHERE user_id = #{userId}
        AND deleted = FALSE
        AND type = #{vo.usageEnum}
        ORDER BY date DESC, id DESC
        LIMIT #{vo.limit} OFFSET #{vo.page}
    </select>

    <!-- 按关键字模糊搜索 -->
    <select id="queryBillListOrderByKeyword" resultType="com.zeyuli.pojo.bo.GetBillListBo">
        SELECT id, record_enum, amount, date
        FROM bill_sys.user_bill
        WHERE user_id = #{userId}
        AND deleted = FALSE
        <if test="vo.keyword != null and vo.keyword != ''">
            AND remarks LIKE '%' || #{vo.keyword} || '%'
        </if>
        ORDER BY date DESC, id DESC
        LIMIT #{vo.limit} OFFSET #{vo.page}
    </select>

</mapper>